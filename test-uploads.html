<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Uploads - ParaTube</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: #f9f9f9;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .test-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-section h2 {
            color: #065fd4;
            font-size: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid #065fd4;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #333;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input[type="file"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
        }

        button {
            background: #065fd4;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 4px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #0553c2;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 4px;
            display: none;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .preview {
            margin-top: 15px;
            max-width: 200px;
        }

        .preview img {
            max-width: 100%;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #065fd4;
        }

        .info p {
            margin: 5px 0;
            color: #333;
            font-size: 14px;
        }

        .info strong {
            color: #065fd4;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: #666;
        }

        .loading.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Teste de Sistema de Uploads</h1>

        <div class="info">
            <p><strong>Usu√°rio Logado:</strong> <span id="logged-user">Carregando...</span></p>
            <p><strong>ID do Usu√°rio:</strong> <span id="user-id">-</span></p>
        </div>

        <!-- Test 1: Avatar Upload -->
        <div class="test-section">
            <h2>üì∏ Teste 1: Upload de Avatar (Foto de Perfil)</h2>
            <form id="avatar-form">
                <div class="form-group">
                    <label for="avatar-file">Selecione uma imagem (JPEG, PNG, GIF ou WebP):</label>
                    <input type="file" id="avatar-file" name="avatar" accept="image/*" required>
                </div>
                <div class="preview" id="avatar-preview"></div>
                <button type="submit">Fazer Upload do Avatar</button>
                <div class="loading" id="avatar-loading">Enviando...</div>
                <div class="result" id="avatar-result"></div>
            </form>
        </div>

        <!-- Test 2: Video Upload -->
        <div class="test-section">
            <h2>üé• Teste 2: Upload de V√≠deo</h2>
            <form id="video-form">
                <div class="form-group">
                    <label for="video-title">T√≠tulo do V√≠deo:</label>
                    <input type="text" id="video-title" name="title" placeholder="Exemplo: Meu Primeiro V√≠deo" required>
                </div>
                <div class="form-group">
                    <label for="video-description">Descri√ß√£o:</label>
                    <textarea id="video-description" name="description" placeholder="Descreva o conte√∫do do v√≠deo..."></textarea>
                </div>
                <div class="form-group">
                    <label for="video-category">Categoria:</label>
                    <select id="video-category" name="category">
                        <option value="music">M√∫sica</option>
                        <option value="gaming">Games</option>
                        <option value="sports">Esportes</option>
                        <option value="education">Educa√ß√£o</option>
                        <option value="entertainment">Entretenimento</option>
                        <option value="news">Not√≠cias</option>
                        <option value="tech">Tecnologia</option>
                        <option value="other">Outros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="video-file">Selecione um v√≠deo (MP4, WebM ou OGG):</label>
                    <input type="file" id="video-file" name="video" accept="video/*" required>
                </div>
                <div class="form-group">
                    <label for="thumbnail-file">Miniatura (opcional - JPEG, PNG, GIF ou WebP):</label>
                    <input type="file" id="thumbnail-file" name="thumbnail" accept="image/*">
                </div>
                <div class="preview" id="thumbnail-preview"></div>
                <button type="submit">Fazer Upload do V√≠deo</button>
                <div class="loading" id="video-loading">Enviando v√≠deo... Isso pode levar alguns segundos.</div>
                <div class="result" id="video-result"></div>
            </form>
        </div>

        <!-- Test 3: Banner Upload -->
        <div class="test-section">
            <h2>üñºÔ∏è Teste 3: Upload de Banner do Canal</h2>
            <form id="banner-form">
                <div class="form-group">
                    <label for="banner-file">Selecione uma imagem para o banner:</label>
                    <input type="file" id="banner-file" name="banner" accept="image/*" required>
                </div>
                <div class="preview" id="banner-preview"></div>
                <button type="submit">Fazer Upload do Banner</button>
                <div class="loading" id="banner-loading">Enviando...</div>
                <div class="result" id="banner-result"></div>
            </form>
        </div>
    </div>

    <script>
        // Check session on page load
        async function checkSession() {
            try {
                const response = await fetch('php/check-session.php');
                const data = await response.json();
                
                if (data.loggedIn) {
                    document.getElementById('logged-user').textContent = data.username || 'Usu√°rio';
                    document.getElementById('user-id').textContent = data.userId || '-';
                } else {
                    document.getElementById('logged-user').innerHTML = '<span style="color: red;">N√£o est√° logado! <a href="login.html">Fazer login</a></span>';
                    document.getElementById('user-id').textContent = '-';
                }
            } catch (error) {
                console.error('Erro ao verificar sess√£o:', error);
                document.getElementById('logged-user').textContent = 'Erro ao carregar';
            }
        }

        // Preview image before upload
        function setupImagePreview(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            input.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Test 1: Avatar Upload
        document.getElementById('avatar-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('avatar-result');
            const loadingDiv = document.getElementById('avatar-loading');
            const fileInput = document.getElementById('avatar-file');
            
            if (!fileInput.files[0]) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Por favor, selecione uma imagem.';
                return;
            }
            
            const formData = new FormData();
            formData.append('avatar', fileInput.files[0]);
            
            loadingDiv.classList.add('active');
            resultDiv.style.display = 'none';
            
            try {
                const response = await fetch('php/upload-avatar.php', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                loadingDiv.classList.remove('active');
                resultDiv.className = data.success ? 'result success' : 'result error';
                resultDiv.textContent = data.message || (data.success ? 'Avatar enviado com sucesso!' : 'Erro ao enviar avatar');
                
                if (data.success) {
                    console.log('‚úÖ Avatar salvo:', data.avatar_url);
                }
            } catch (error) {
                loadingDiv.classList.remove('active');
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Erro: ' + error.message;
                console.error('Erro no upload do avatar:', error);
            }
        });

        // Test 2: Video Upload
        document.getElementById('video-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('video-result');
            const loadingDiv = document.getElementById('video-loading');
            const videoInput = document.getElementById('video-file');
            const thumbnailInput = document.getElementById('thumbnail-file');
            
            if (!videoInput.files[0]) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Por favor, selecione um v√≠deo.';
                return;
            }
            
            const formData = new FormData();
            formData.append('video', videoInput.files[0]);
            formData.append('title', document.getElementById('video-title').value);
            formData.append('description', document.getElementById('video-description').value);
            formData.append('category', document.getElementById('video-category').value);
            
            if (thumbnailInput.files[0]) {
                formData.append('thumbnail', thumbnailInput.files[0]);
            }
            
            // Get video duration
            const video = document.createElement('video');
            video.src = URL.createObjectURL(videoInput.files[0]);
            
            video.addEventListener('loadedmetadata', async function() {
                formData.append('duration', Math.round(video.duration));
                URL.revokeObjectURL(video.src);
                
                loadingDiv.classList.add('active');
                resultDiv.style.display = 'none';
                
                try {
                    const response = await fetch('php/upload-video.php', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    loadingDiv.classList.remove('active');
                    resultDiv.className = data.success ? 'result success' : 'result error';
                    resultDiv.textContent = data.message || (data.success ? 'V√≠deo enviado com sucesso!' : 'Erro ao enviar v√≠deo');
                    
                    if (data.success) {
                        console.log('‚úÖ V√≠deo salvo com ID:', data.videoId);
                        // Reset form
                        e.target.reset();
                        document.getElementById('thumbnail-preview').innerHTML = '';
                    }
                } catch (error) {
                    loadingDiv.classList.remove('active');
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'Erro: ' + error.message;
                    console.error('Erro no upload do v√≠deo:', error);
                }
            });
        });

        // Test 3: Banner Upload
        document.getElementById('banner-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('banner-result');
            const loadingDiv = document.getElementById('banner-loading');
            const fileInput = document.getElementById('banner-file');
            
            if (!fileInput.files[0]) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Por favor, selecione uma imagem.';
                return;
            }
            
            const formData = new FormData();
            formData.append('banner', fileInput.files[0]);
            
            loadingDiv.classList.add('active');
            resultDiv.style.display = 'none';
            
            try {
                const response = await fetch('php/update-channel-customization.php', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                loadingDiv.classList.remove('active');
                resultDiv.className = data.success ? 'result success' : 'result error';
                resultDiv.textContent = data.message || (data.success ? 'Banner enviado com sucesso!' : 'Erro ao enviar banner');
                
                if (data.success) {
                    console.log('‚úÖ Banner salvo');
                }
            } catch (error) {
                loadingDiv.classList.remove('active');
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Erro: ' + error.message;
                console.error('Erro no upload do banner:', error);
            }
        });

        // Setup image previews
        setupImagePreview('avatar-file', 'avatar-preview');
        setupImagePreview('thumbnail-file', 'thumbnail-preview');
        setupImagePreview('banner-file', 'banner-preview');

        // Check session on load
        checkSession();
    </script>
</body>
</html>
