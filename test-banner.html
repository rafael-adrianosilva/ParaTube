<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Teste de Banner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #181818;
            color: #fff;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #ff0000;
        }
        .test-section {
            background: #212121;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .banner-preview {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #606060 0%, #303030 100%);
            border-radius: 12px;
            margin: 20px 0;
            background-size: cover;
            background-position: center;
        }
        button {
            background: #ff0000;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #cc0000;
        }
        .result {
            background: #0d0d0d;
            padding: 16px;
            border-radius: 8px;
            margin-top: 12px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
        .success { color: #44ff44; }
        .error { color: #ff4444; }
        .info { color: #44aaff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Teste de Banner - ParaTube</h1>
        
        <div class="test-section">
            <h2>1. Verificar API de Customiza√ß√£o</h2>
            <button onclick="testAPI()">‚ñ∂Ô∏è Testar API</button>
            <div class="result" id="apiResult"></div>
        </div>

        <div class="test-section">
            <h2>2. Preview do Banner</h2>
            <button onclick="loadBanner()">‚ñ∂Ô∏è Carregar Banner</button>
            <div class="banner-preview" id="bannerPreview"></div>
            <div class="result" id="bannerResult"></div>
        </div>

        <div class="test-section">
            <h2>3. Testar Upload de Banner</h2>
            <p style="color: #aaa;">Para testar upload, v√° para: <a href="customize-channel.html" style="color: #ff0000;">customize-channel.html</a></p>
        </div>

        <div class="test-section">
            <h2>4. Verificar Arquivos de Banner</h2>
            <button onclick="checkBannerFiles()">‚ñ∂Ô∏è Verificar Arquivos</button>
            <div class="result" id="filesResult"></div>
        </div>
    </div>

    <script>
        async function testAPI() {
            const result = document.getElementById('apiResult');
            result.innerHTML = '<span class="info">‚è≥ Carregando...</span>';

            try {
                const userStr = localStorage.getItem('user');
                if (!userStr) {
                    result.innerHTML = '<span class="error">‚ùå Voc√™ precisa estar logado!</span>';
                    return;
                }

                const user = JSON.parse(userStr);
                console.log('üë§ User:', user);

                const response = await fetch('php/get-channel-customization.php', {
                    headers: { 'X-User-Id': user.id.toString() }
                });

                console.log('üì° Response status:', response.status);

                if (!response.ok) {
                    result.innerHTML = `<span class="error">‚ùå Erro HTTP: ${response.status}</span>`;
                    return;
                }

                const data = await response.json();
                console.log('üì¶ Data:', data);

                let output = '<span class="success">‚úÖ API respondeu com sucesso!</span>\n\n';
                output += '<span class="info">Dados recebidos:</span>\n';
                output += JSON.stringify(data, null, 2);

                if (data.success && data.banner) {
                    output += '\n\n<span class="success">‚úÖ Banner encontrado: ' + data.banner + '</span>';
                } else {
                    output += '\n\n<span class="error">‚ö†Ô∏è Nenhum banner configurado</span>';
                }

                result.innerHTML = output;

            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
                console.error('Error:', error);
            }
        }

        async function loadBanner() {
            const result = document.getElementById('bannerResult');
            const preview = document.getElementById('bannerPreview');
            
            result.innerHTML = '<span class="info">‚è≥ Carregando banner...</span>';

            try {
                const userStr = localStorage.getItem('user');
                if (!userStr) {
                    result.innerHTML = '<span class="error">‚ùå Voc√™ precisa estar logado!</span>';
                    return;
                }

                const user = JSON.parse(userStr);
                const response = await fetch('php/get-channel-customization.php', {
                    headers: { 'X-User-Id': user.id.toString() }
                });

                const data = await response.json();

                if (data.success && data.banner) {
                    const bannerUrl = data.banner + '?t=' + new Date().getTime();
                    preview.style.backgroundImage = `url('${bannerUrl}')`;
                    preview.style.backgroundSize = 'cover';
                    preview.style.backgroundPosition = 'center';
                    
                    result.innerHTML = `<span class="success">‚úÖ Banner carregado!</span>\n`;
                    result.innerHTML += `<span class="info">URL: ${data.banner}</span>\n`;
                    result.innerHTML += `<span class="info">Com cache-buster: ${bannerUrl}</span>`;
                    
                    // Test if image loads
                    const img = new Image();
                    img.onload = () => {
                        result.innerHTML += '\n<span class="success">‚úÖ Imagem carregada com sucesso!</span>';
                    };
                    img.onerror = () => {
                        result.innerHTML += '\n<span class="error">‚ùå Erro ao carregar imagem!</span>';
                        result.innerHTML += '\n<span class="error">Verifique se o arquivo existe no servidor</span>';
                    };
                    img.src = bannerUrl;
                    
                } else {
                    result.innerHTML = '<span class="error">‚ö†Ô∏è Nenhum banner configurado</span>';
                    result.innerHTML += '\n<span class="info">Fa√ßa upload de um banner em customize-channel.html</span>';
                }

            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
            }
        }

        async function checkBannerFiles() {
            const result = document.getElementById('filesResult');
            result.innerHTML = '<span class="info">‚è≥ Verificando...</span>';

            try {
                const userStr = localStorage.getItem('user');
                if (!userStr) {
                    result.innerHTML = '<span class="error">‚ùå Voc√™ precisa estar logado!</span>';
                    return;
                }

                const user = JSON.parse(userStr);
                const response = await fetch('php/get-channel-customization.php', {
                    headers: { 'X-User-Id': user.id.toString() }
                });

                const data = await response.json();

                let output = '<span class="info">üìÅ Verificando arquivos de banner...</span>\n\n';

                if (data.success && data.banner) {
                    output += `<span class="info">Banner registrado no banco:</span>\n`;
                    output += `  ${data.banner}\n\n`;

                    // Try to fetch the image
                    const imgResponse = await fetch(data.banner);
                    
                    if (imgResponse.ok) {
                        output += `<span class="success">‚úÖ Arquivo existe no servidor!</span>\n`;
                        output += `<span class="info">  Status: ${imgResponse.status}</span>\n`;
                        output += `<span class="info">  Type: ${imgResponse.headers.get('content-type')}</span>\n`;
                        output += `<span class="info">  Size: ${imgResponse.headers.get('content-length')} bytes</span>`;
                    } else {
                        output += `<span class="error">‚ùå Arquivo N√ÉO encontrado no servidor!</span>\n`;
                        output += `<span class="error">  Status: ${imgResponse.status}</span>\n`;
                        output += `<span class="error">  O arquivo pode ter sido deletado</span>`;
                    }
                } else {
                    output += '<span class="error">‚ö†Ô∏è Nenhum banner configurado no banco de dados</span>';
                }

                result.innerHTML = output;

            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
            }
        }

        // Auto-run on load
        window.addEventListener('DOMContentLoaded', () => {
            const userStr = localStorage.getItem('user');
            if (userStr) {
                console.log('üöÄ Executando testes autom√°ticos...');
                testAPI();
            } else {
                document.getElementById('apiResult').innerHTML = '<span class="error">‚ùå Fa√ßa login primeiro!</span>';
            }
        });
    </script>
</body>
</html>
